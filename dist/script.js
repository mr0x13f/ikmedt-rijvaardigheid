!function(t){var e={};function n(i){if(e[i])return e[i].exports;var o=e[i]={i:i,l:!1,exports:{}};return t[i].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=t,n.c=e,n.d=function(t,e,i){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)n.d(i,o,function(e){return t[e]}.bind(null,o));return i},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=0)}([function(t,e,n){"use strict";var i;n.r(e),function(t){t[t.ACCELERATE=0]="ACCELERATE",t[t.BRAKE=1]="BRAKE",t[t.STEERING=2]="STEERING",t[t.CLUTCH=3]="CLUTCH",t[t.HANDBRAKE=4]="HANDBRAKE",t[t.HEADLIGHTS=5]="HEADLIGHTS",t[t.NEUTRAL=6]="NEUTRAL",t[t.DOGBOX_UP=7]="DOGBOX_UP",t[t.DOGBOX_DOWN=8]="DOGBOX_DOWN",t[t.PAUSE=9]="PAUSE",t[t.CONFIRM=10]="CONFIRM"}(i||(i={}));var o,r,s,u,a,h=function(){function t(t){this.inverted=!1,this.minValue=0,this.index=t}return t.prototype.getValue=function(t){return t.buttons[this.index].value*(this.inverted?-1:1)},t.prototype.isPressed=function(t){return this.getValue(t)>this.minValue},t.prototype.invert=function(){this.inverted=!0},t.prototype.setMinValue=function(t){this.minValue=t},t}(),c=function(){function t(t){this.minDeadzone=0,this.maxDeadzone=1,this.isNormalized=!1,this.index=t}return t.prototype.getValue=function(t){var e=t.axes[this.index].valueOf(),n=e>0,i=Math.abs(e);return i<this.minDeadzone?i=this.minDeadzone:i>this.maxDeadzone&&(i=this.maxDeadzone),i=(i-this.minDeadzone)/(this.maxDeadzone-this.minDeadzone),i*=n?1:-1,this.isNormalized&&(i=i/2+.5),i},t.prototype.isPressed=function(t){return!1},t.prototype.deadzone=function(t,e){return this.minDeadzone=t,this.maxDeadzone=e,this},t.prototype.normalize=function(){return this.isNormalized=!0,this},t}(),d=function(){function t(t){this.triggerPoint=0,this.inverted=!1,this.input=t}return t.prototype.getValue=function(t){return this.input.getValue(t)*(this.inverted?-1:1)},t.prototype.isPressed=function(t){return this.getValue(t)>=this.triggerPoint},t.prototype.invert=function(){return this.inverted=!0,this},t.prototype.setTriggerPoint=function(t){return this.triggerPoint=t,this},t}(),l=function(){function t(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.inputs=t}return t.prototype.getValue=function(t){return this.isPressed(t)?1:0},t.prototype.isPressed=function(t){for(var e=0,n=this.inputs;e<n.length;e++){if(n[e].isPressed(t))return!0}return!1},t}(),p=function(){var t;this.NAME="STANDARD GAMEPAD",this.MAPPING=((t={})[i.STEERING]=new c(0).deadzone(.01,1),t[i.ACCELERATE]=new h(7),t[i.BRAKE]=new h(6),t[i.CLUTCH]=new l(new h(4),new h(5)),t[i.HANDBRAKE]=new h(0),t[i.HEADLIGHTS]=new h(2),t[i.NEUTRAL]=new h(11),t[i.DOGBOX_UP]=new d(new c(3)).setTriggerPoint(.5).invert(),t[i.DOGBOX_DOWN]=new d(new c(3)).setTriggerPoint(.5),t[i.PAUSE]=new h(9),t[i.CONFIRM]=new h(0),t)},f=function(){var t;this.NAME="MAYFLASH GameCube Controller Adapter",this.MAPPING=((t={})[i.STEERING]=new c(0).deadzone(.05,.75),t[i.ACCELERATE]=new c(4).deadzone(0,.6).normalize(),t[i.BRAKE]=new c(3).deadzone(0,.6).normalize(),t[i.CLUTCH]=new h(7),t[i.HANDBRAKE]=new h(1),t[i.HEADLIGHTS]=new h(12),t[i.NEUTRAL]=new h(2),t[i.DOGBOX_UP]=new d(new c(2)).setTriggerPoint(.3).invert(),t[i.DOGBOX_DOWN]=new d(new c(2)).setTriggerPoint(.3),t[i.PAUSE]=new h(9),t[i.CONFIRM]=new h(1),t)};!function(t){var e,n,o=[],r={},s={};function u(t){o.push(t)}function a(t){var i=t;console.log(i.gamepad.id+" has connected.");for(var r=null,s=0,u=o;s<u.length;s++){var a=u[s];-1!=i.gamepad.id.search(a.NAME)&&(r=a)}r?(e=i.gamepad,n=r,console.log("Controller mapping applied: "+r.NAME)):alert("No controller mapping found for "+i.gamepad.id)}function h(t){var n=t;n.gamepad==e&&(e=null,console.log(n.gamepad.id+" has disconnected."))}t.init=function(){u(new p),u(new f),window.addEventListener("gamepadconnected",a),window.addEventListener("gamepaddisconnected",h)},t.handleInputs=function(){if(s=r,r={},e&&(e=navigator.getGamepads()[e.index]))for(var t in i)isNaN(Number(t))||n.MAPPING[t].isPressed(e)&&(r[t]=!0)},t.isDown=function(t){return!!e&&1==r[t]},t.isPressed=function(t){return!!e&&(1==r[t]&&1!=s[t])},t.getAxes=function(t){return e?n.MAPPING[t].getValue(e):0}}(o||(o={})),s=r||(r={}),u=[],a={},s.init=function(){var t;u=[],a={},t=0,window.requestAnimationFrame((function e(n){s.dt=(n-t)/1e3,t=n,o.handleInputs(),function(){for(var t=0,e=u;t<e.length;t++)e[t].doUpdate()}(),window.requestAnimationFrame(e)}))},s.addEntity=function(t){u.push(t),t.id&&(a[t.id]=t)},s.getEntityById=function(t){return a[t]};var y,E,g,m,R=function(){function t(){}return t.getSource=function(){return""},t.load=function(t){},t.show=function(t){var e=this,n=document.getElementById("js--scene");n.setAttribute("template","src",this.getSource()),r.init(),n.addEventListener("DOMNodeInserted",(function(n){window.requestAnimationFrame((function(){e.load(t)}))}))},t}(),w=function(){function t(t,e,n){this.x=0,this.y=0,this.z=0,this.x=t||0,this.y=e||t||0,this.z=n||t||0}return t.prototype.toString=function(){return"("+this.x+","+this.y+","+this.z+")"},t.prototype.magnitude=function(){return Math.sqrt(this.magnitude2())},t.prototype.magnitude2=function(){return this.x*this.x+this.y*this.y+this.z*this.z},t.prototype.normalize=function(){return this.divNum(this.magnitude())},t.prototype.add=function(e){return new t(this.x+e.x,this.y+e.y,this.z+e.z)},t.prototype.sub=function(e){return new t(this.x-e.x,this.y-e.y,this.z-e.z)},t.prototype.mul=function(e){return new t(this.x*e.x,this.y*e.y,this.z*e.z)},t.prototype.div=function(e){return new t(this.x/e.x,this.y/e.y,this.z/e.z)},t.prototype.mulNum=function(e){return new t(this.x*e,this.y*e,this.z*e)},t.prototype.divNum=function(e){return new t(this.x/e,this.y/e,this.z/e)},t.prototype.numDiv=function(e){return new t(e/this.x,e/this.y,e/this.z)},t}(),D=function(){function t(t){this.element=null,this.object3D=null,this.id=null,t?(this.id=t,this.element=document.getElementById(t),this.object3D=this.element.object3D,this.position=new w(this.object3D.position.x,this.object3D.position.y,this.object3D.position.z),this.rotation=new w(this.object3D.rotation.x,this.object3D.rotation.y,this.object3D.rotation.z),this.velocity=new w(0,0,0)):(this.position=new w(0,0,0),this.rotation=new w(0,0,0),this.velocity=new w(0,0,0)),r.addEntity(this)}return t.prototype.update=function(){},t.prototype.doUpdate=function(){this.update(),this.velocity.magnitude()<.001&&(this.velocity=new w(0,0,0)),this.position=this.position.add(this.velocity.mulNum(r.dt)),this.object3D.position.x=this.position.x,this.object3D.position.y=this.position.y,this.object3D.position.z=this.position.z,this.object3D.rotation.x=this.rotation.x,this.object3D.rotation.y=this.rotation.y,this.object3D.rotation.z=this.rotation.z},t}();!function(t){t.REVERSE="R",t.NEUTRAL="N",t.FIRST="1",t.SECOND="2",t.THIRD="3",t.FOURTH="4",t.FIFTH="5"}(m||(m={}));var A,v,T=((y={})[m.REVERSE]=m.NEUTRAL,y[m.NEUTRAL]=m.FIRST,y[m.FIRST]=m.SECOND,y[m.SECOND]=m.THIRD,y[m.THIRD]=m.FOURTH,y[m.FOURTH]=m.FIFTH,y[m.FIFTH]=null,y),O=((E={})[m.REVERSE]=null,E[m.NEUTRAL]=m.REVERSE,E[m.FIRST]=m.NEUTRAL,E[m.SECOND]=m.FIRST,E[m.THIRD]=m.SECOND,E[m.FOURTH]=m.THIRD,E[m.FIFTH]=m.FOURTH,E),I=((g={})[m.REVERSE]=new w(.5,-.5,0),g[m.NEUTRAL]=new w(0,0,0),g[m.FIRST]=new w(-.5,.5,0),g[m.SECOND]=new w(-.5,-.5,0),g[m.THIRD]=new w(0,.5,0),g[m.FOURTH]=new w(0,-.5,0),g[m.FIFTH]=new w(-.5,.5,0),A=function(t,e){return(A=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}A(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),N=function(t){function e(e,n){var i,o=t.call(this,e)||this;return o.isHeadlightsOn=!1,o.direction=new w,o.currentGear=m.FIRST,o.gearIndicatorMap=((i={})[m.REVERSE]="-43 87 35",i[m.NEUTRAL]="-38 90 35",i[m.FIRST]="-33 93 35",i[m.SECOND]="-33 87 35",i[m.THIRD]="-38 93 35",i[m.FOURTH]="-38 87 35",i[m.FIFTH]="-43 93 35",i),o.carModel=n,o.headlightLeft=document.getElementById("js--car-headlight-left"),o.headlightRight=document.getElementById("js--car-headlight-right"),o.steeringWheel=document.getElementById("js--car-steering-wheel"),o.debugText=document.getElementById("js--debug-text"),o.gearIndicator=document.getElementById("js--gear-indicator"),o.velocity=new w(0,0,0),o.direction=new w(0,0,-1),o.setHeadlights(!1),o}return I(e,t),e.prototype.update=function(){o.isPressed(i.HEADLIGHTS)&&this.toggleHeadlights(),this.shift(),this.physics(),this.turnSteeringWheel()},e.prototype.toggleHeadlights=function(){this.isHeadlightsOn=!this.isHeadlightsOn,this.updateHeadlights()},e.prototype.setHeadlights=function(t){this.isHeadlightsOn=t,this.updateHeadlights()},e.prototype.updateHeadlights=function(){this.headlightLeft.setAttribute("visible",""+this.isHeadlightsOn),this.headlightRight.setAttribute("visible",""+this.isHeadlightsOn)},e.prototype.shift=function(){o.isDown(i.CLUTCH)&&(o.isPressed(i.DOGBOX_UP)&&O[this.currentGear]&&(this.currentGear=O[this.currentGear],this.updateGear()),o.isPressed(i.DOGBOX_DOWN)&&T[this.currentGear]&&(this.currentGear=T[this.currentGear],this.updateGear()))},e.prototype.updateGear=function(){console.log(this.currentGear),this.updateGearUI()},e.prototype.updateGearUI=function(){var t=this.gearIndicatorMap[this.currentGear];this.gearIndicator.setAttribute("position",t)},e.prototype.turnSteeringWheel=function(){var t=o.getAxes(i.STEERING);this.steeringWheel.object3D.rotation.z=90*t/180*Math.PI},e.prototype.physics=function(){this.velocity.magnitude2()>0&&(this.direction=this.velocity.normalize());var t=this.carModel.torqueCurve(1e3)*o.getAxes(i.ACCELERATE)*this.carModel.gearRatios[this.currentGear]*this.carModel.differentialRatio*this.carModel.transmissionEfficiency/this.carModel.wheelRadius,e=this.velocity.mulNum(-this.carModel.dragConstant*this.velocity.magnitude()),n=this.velocity.mulNum(-this.carModel.rollingResistanceConstant),s=e.add(n),u=this.direction.mulNum(t);s=s.add(u),this.velocity=this.velocity.add(s.mulNum(r.dt).divNum(this.carModel.mass)),this.debugText.setAttribute("value",this.velocity.magnitude()+"\nkm/h")},e}(D),H=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}();!function(t){t[t.DAY=0]="DAY",t[t.NIGHT=1]="NIGHT"}(v||(v={}));var S,b=function(t){function e(n){var i=t.call(this,n)||this;return i.currentSky=v.DAY,e.skies[v.DAY]=document.getElementById("js--sky-day"),e.skies[v.NIGHT]=document.getElementById("js--sky-night"),i.currentSky=v.DAY,i.setSky(i.currentSky),i}return H(e,t),e.prototype.setSky=function(t){this.clearSky(),this.currentSky=t,e.skies[t].setAttribute("visible","true")},e.prototype.clearSky=function(){e.skies[v.DAY].setAttribute("visible","false"),e.skies[v.NIGHT].setAttribute("visible","false")},e.skies={},e}(D);!function(t){t[t.REAR_WHEEL_DRIVE=0]="REAR_WHEEL_DRIVE",t[t.FRONT_WHEEL_DRIVE=1]="FRONT_WHEEL_DRIVE",t[t.FOUR_WHEEL_DRIVE=2]="FOUR_WHEEL_DRIVE"}(S||(S={}));var P=function(){function t(){var t;this.frameModel="",this.steeringWheelModel="",this.handBrakeModel="",this.headlightPosition=new w,this.cameraPosition=new w,this.steeringWheelPosition=new w,this.dragConstant=.4257,this.brakingConstant=0,this.wheelRadius=.3265,this.frontWheelPosition=new w,this.rearWheelPosition=new w,this.mass=1560,this.centerOfGravity=new w,this.layout=S.FOUR_WHEEL_DRIVE,this.rollingResistanceConstant=12.8,this.transmissionEfficiency=.7,this.differentialRatio=3.42,this.gearRatios=((t={})[m.REVERSE]=2.9,t[m.NEUTRAL]=0,t[m.FIRST]=2.66,t[m.SECOND]=1.78,t[m.THIRD]=1.3,t[m.FOURTH]=1,t[m.FIFTH]=.74,t),this.idleRpm=1e3,this.stallRpm=1e3,this.redlineRpm=7e3}return t.prototype.torqueCurve=function(t){return-3792735043e-15*t*t+.03803418803*t+254.6474359},t}(),_=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),z=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return _(e,t),e.getSource=function(){return"scenes/simulation.html"},e.load=function(t){new N("js--car",new P).setHeadlights(!1),new b("js--sky").setSky(v.DAY)},e}(R);window.onload=function(){o.init(),z.show()}}]);